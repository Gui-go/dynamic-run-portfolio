<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D3 Projection Gallery</title>
  <style>
    body {
      font-family: "Helvetica Neue", Helvetica, sans-serif;
      font-size: 14px;
      color: #333;
      width: 900px;
      margin: 0 auto;
    }

    canvas {
      border: 1px solid #eee;
      margin: 5px;
    }

    .description {
      margin: 10px 0;
    }

    h1 {
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>üåê D3 Projection Gallery</h1>
  <p class="description">This example shows multiple D3 projections rendered with Canvas elements using different geographic views.</p>
  <div id="content"></div>

  <script type="module">
    import { select } from 'https://esm.sh/d3-selection';
    import * as geo from 'https://esm.sh/d3-geo';
    import { json } from 'https://esm.sh/d3-fetch';

    let geojson = {};

    let projections = [
      {type: 'AzimuthalEqualArea', scale: 100},
      {type: 'AzimuthalEquidistant', scale: 80},
      {type: 'Gnomonic', scale: 100},
      {type: 'Orthographic', scale: 160},
      {type: 'Stereographic', scale: 100},
      {type: 'Albers', scale: 120},
      {type: 'ConicConformal', scale: 100},
      {type: 'ConicEqualArea', scale: 100},
      {type: 'ConicEquidistant', scale: 100},
      {type: 'Equirectangular', scale: 80},
      {type: 'Mercator', scale: 70},
      {type: 'TransverseMercator', scale: 70},
    ];

    let circles = [[0, 0], [-90, 0], [-45, 0], [45, 0], [90, 0], [0, -70], [0, -35], [0, 35], [0, 70]];
    let geoCircle = geo.geoCircle().radius(10).precision(1);
    let geoGraticule = geo.geoGraticule();

    let width = 200, height = 200, globalScale = 0.5;

    function updateCanvas(d) {
      let context = this.getContext('2d');

      let projection = geo['geo' + d.type]()
        .scale(globalScale * d.scale)
        .center([0, 0])
        .rotate([0.1, 0, 0])
        .translate([0.5 * width, 0.5 * height]);

      let geoGenerator = geo.geoPath()
        .projection(projection)
        .context(context);

      context.clearRect(0, 0, width, height);
      context.lineWidth = 0.5;

      // Graticule
      context.strokeStyle = '#ccc';
      context.fillStyle = 'none';
      context.setLineDash([1,1]);
      context.beginPath();
      geoGenerator(geoGraticule());
      context.stroke();

      // World
      context.fillStyle = '#eee';
      context.setLineDash([]);
      context.beginPath();
      geoGenerator({type: 'FeatureCollection', features: geojson.features});
      context.fill();
      context.stroke();

      // Circles
      context.strokeStyle = '#888';
      context.fillStyle = 'none';
      circles.forEach(function(center) {
        geoCircle.center(center);
        context.beginPath();
        geoGenerator(geoCircle());
        context.stroke();
      });

      // Projection label
      context.fillStyle = '#333';
      context.font = '14px sans-serif';
      context.fillText('geo' + d.type, 6, 17);
    }

    function update() {
      let u = select('#content')
        .selectAll('canvas')
        .data(projections);

      u.enter()
        .append('canvas')
        .attr('width', width + 'px')
        .attr('height', height + 'px')
        .merge(u)
        .each(updateCanvas);

      u.exit().remove();
    }

    // Load GeoJSON and render
    json('https://gist.githubusercontent.com/d3indepth/f28e1c3a99ea6d84986f35ac8646fac7/raw/c58cede8dab4673c91a3db702d50f7447b373d98/ne_110m_land.json')
      .then(function(jsonData) {
        geojson = jsonData;
        update();
      });
  </script>
</body>
</html>
